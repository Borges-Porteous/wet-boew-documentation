---
published: true
layout: default-theme-wet-boew-en
title: Test case 1 - With heading - Heading in summary element
description: Test page to evaluate AT when heading is present in summary elements
modified: 2018-07-05
---

Test page to evaluate AT when heading is present in summary elements.

<span class="wb-prettify all-pre"></span>

## Summary

A single heading element is allowable as the content of a `<summary>` element in the [HTML 5.1 specification for summary](https://www.w3.org/TR/html51/interactive-elements.html#the-summary-element):

> **Content model:**
> Either: phrasing content.
> Or: one element of heading content.

However, browser and screen reader support for this is even less consistent than with only plain text in the summary.

## Expected behaviour

The expand / collapse should work identically to when a [heading is not present in the summary](./2018-2.html).
* Summaries show in buttons list.
* The expanded / collapsed state should show in the buttons list.
* Activating a collapsed summary with the keyboard should expand it.
* Activating an expanded summary with the keyboard should collapse it.
* The expanded / collapsed state should be voiced by the screen reader
* An expand / collapse action should be voiced by the screen reader.

Additionally, a summary with a heading should appear in the headings list.

## Vanilla HTML example in iframe

The `iframe` is to prevent current WET behaviours such as the detail/summary polyfill.

### Code

```
<html>
  <body>
    <details>
      <summary>
        <h4>h4 within summary</h4>
      </summary>
      <p>
        Details body paragraph
      </p>
      Unwrapped text
      <div>Some content in a div with <a href="#">a link</a></div>
    </details>
  </body>
</html>
```

### Demo

{% raw %}
<iframe src="./assets/detailSummaryH4.html"></iframe>
{% endraw %}

### Results

None of the browsers tested matched the expected behaviour. \* indicates that behaviour is quirky. See notes below.

| Browser + AT            | Headings list    | Buttons list    | Expandable / collapsible | State voiced | Expansion / collapse voiced |
| ----------------------- | ---------------- | --------------- | ------------------------ | ------------ | --------------------------- |
| Expected                | Yes              | Yes             | Yes                      | Yes          | Yes                         |
| Chrome 67 \*            | Yes              | Yes             | Yes \*                   | Yes          | Yes \*                      |
| Firefox 61              | Yes              | Yes             | Yes \*                   | Yes          | No                          |
| IE 11                   | Yes              | No              | No                       | No           | No                          |

#### Quirks
* Chrome will collapse and expand as expected when activated by mouse click, but not with keyboard.
* Chrome will voice expansion / collapse but only when clicking the icon, not the heading text.
* Firefox will collapse and expand as expected when activated by mouse click, but not with keyboard.
* Firefox will produce strange behaviour (window switching, etc) when activating with keyboard.

## Javascript enhanced example

The `iframe` is to prevent current WET behaviours such as the detail/summary polyfill.

The HTML markup is identical to the vanilla example above. Using javascript, the native `detail` and `summary` elements are replaced onload with `div` and `button` elements respectively, and the correct behaviour is implemented on click and keydown events.

Note that the `button` element must be nested **inside** the heading element.

Inspired by [accessible expanding / collapsing sections](http://www.mit.edu/~rjc/aria/expandingSections.html).

### Code

#### HTML:
```
<html>
  <style>
    div.__detailSummary .__details {
      display: none;
    }
    div.__detailSummary div.__details.__expanded {
      display: block;
    }
    div.__detailSummary button.__summary {
      background: none;
      color: inherit;
      border: none;
      padding: 0;
      font: inherit;
      cursor: pointer;
      outline: inherit;
    }
    div.__detailSummary button.__summary:focus {
      text-decoration: underline;
      outline: dotted 1px black;
    }
  </style>
  <body>
    <details>
      <summary>
        <h4>h4 within summary</h4>
      </summary>
      <p>
        Details body paragraph
      </p>
      Unwrapped text
      <div>Some content in a div with <a href="#">a link</a></div>
    </details>
  </body>
  <script src="detailSummary.js"></script>
</html>
```

#### Javascript:
```

// Convert native detail/summary to accessible cross-browser syntax
// This implementation is not robust due to string manipulations
// and should be treated only as a proof of concept

(function(){

var detailsElements = document.querySelectorAll("details");

[].forEach.call(detailsElements, convertToButton);

function convertToButton(details) {

  // Create new wrapper element to replace <details>
  var newDetails = document.createElement("div");
  newDetails.classList.add("__detailSummary");
  var newHTML = "";

  // Get content of <summary> and other content
  var detailsHTML = details.innerHTML.split("<summary>")[1].split("</summary>");
  var summaryContent = detailsHTML[0];
  var detailsContent = detailsHTML[1];

  var headingLevel = 0;

  // Check for a header within the summary
  if (summaryContent.split("<h").length > 1) {
    headingLevel = summaryContent.split("<h")[1][0];

    // Remove header tags from summary content
    summaryContent = summaryContent.split(">")[1].split("</")[0];

    // Wrap <button> with appropriate header tag
    newHTML += "<h" + headingLevel + ">";
  }

  // Repackage <summary> into <button> which toggles the details
  newHTML += "<button class='__summary'>" + summaryContent + "</button>";

  // Close header tag, if opened
  if (headingLevel > 0) {
    newHTML += "</h" + headingLevel + ">";
  }

  // Repackage details into <div> whose visibility is toggled
  newHTML += "<div class='__details'>" + detailsContent + "</div>";
  newDetails.innerHTML = newHTML;

  // Replace <details> with new element
  details.parentNode.replaceChild(newDetails, details);

  // Listen for enter and spacebar
  newDetails.firstChild.addEventListener("keydown", function(event){
    if (event.which !== 13 && event.which !== 32) {
      return true;
    }
    event.preventDefault();
    toggleExpanded(newDetails);
    return true;
  });

  // Listen for click
  newDetails.firstChild.addEventListener("click", function(event){
    event.preventDefault();
    toggleExpanded(newDetails);
    return true;
  });

}

function toggleExpanded(details) {
  var summary = details.querySelector("button");
  var content = details.querySelector("div.__details");
  var expanded = summary.getAttribute("aria-expanded") === "true";
  summary.setAttribute("aria-expanded", expanded ? "false" : "true");
  expanded ? content.classList.remove("__expanded") : content.classList.add("__expanded");
}

})();
```

### Demo

{% raw %}
<iframe src="./assets/detailSummaryH4JS.html"></iframe>
{% endraw %}

### Results with NVDA 2018

All browsers tested matched the expected behaviour.

| Browser + AT            | Headings list    | Buttons list    | Expandable / collapsible | State voiced | Expansion / collapse voiced |
| ----------------------- | ---------------- | --------------- | ------------------------ | ------------ | --------------------------- |
| Expected                | Yes              | Yes             | Yes                      | Yes          | Yes                         |
| **Chrome 67**           | Yes              | Yes             | Yes                      | Yes          | Yes                         |
| **Firefox 61**          | Yes              | Yes             | Yes                      | Yes          | Yes                         |
| **IE 11**               | Yes              | Yes             | Yes                      | Yes          | Yes                         |
